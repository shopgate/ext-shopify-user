{
	"info": {
		"name": "Shopify Local",
		"_postman_id": "52dcc066-f37a-0ee2-0e45-e7bf5a33de5b",
		"description": "",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "addAddress",
			"event": [
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.test(\"Successful added a new address\", function () {",
							"    pm.response.to.have.status(200);",
							"    pm.response.to.have.body({success: true});",
							"});",
							"",
							"// Try again with the same address to receive the specific error message",
							"pm.test(\"Should return error, because address already taken\", function() {",
							"    pm.sendRequest({",
							"        url: pm.environment.get(\"addAddressUrl\"),",
							"        method: 'POST',",
							"        header: pm.environment.get(\"requestHeader\"),",
							"        body: ",
							"        {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                address: {",
							"                    street1: pm.environment.get(\"randomizedStreet\"),",
							"                    country: 'GB'",
							"                }",
							"            })",
							"        },",
							"        json: true,",
							"        function (err, res) {",
							"            pm.expect(res.text()).to.include(\"has already been taken\");",
							"        }",
							"    });",
							"    ",
							"})",
							"",
							"",
							"// Try again with a invalid country to receive the specific error message",
							"pm.test(\"Should return error, because of an invalid country\", function() {",
							"    pm.sendRequest({",
							"        url: pm.environment.get(\"addAddressUrl\"),",
							"        method: 'POST',",
							"        header: pm.environment.get(\"requestHeader\"),",
							"        body: ",
							"        {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                address: { ",
							"                    street1: Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15),",
							"                    country: 'Banana-Island'",
							"                }",
							"            })",
							"        },",
							"        json: true,",
							"        function (err, res) {",
							"            pm.expect(res.text()).to.include(\"is not a valid country\");",
							"        }",
							"    });",
							"    ",
							"})",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"addAddressUrl\", \"http://192.168.2.108:8090/trustedPipelines/shopgate.user.addAddress.v1\");",
							"pm.environment.set(\"loginUrl\", \"http://192.168.2.108:8090/trustedPipelines/shopgate.user.loginUser.v1\");",
							"pm.environment.set(\"requestHeader\", { ",
							"            'postman-token': 'cac8b133-6c11-82be-ce3e-f765688ec323',",
							"            'cache-control': 'no-cache',",
							"            'content-type': 'application/json'",
							"})",
							"",
							"pm.sendRequest(",
							"    {",
							"        url: pm.environment.get(\"loginUrl\"),",
							"        method: 'POST',",
							"        header: pm.environment.get(\"requestHeader\"),",
							"        body: ",
							"        {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                strategy: 'basic',",
							"                parameters: { login: 'ronny.lindner@shopgate.com', password: '123456kill' }",
							"            })",
							"        },",
							"        json: true,",
							"        function (err, res) {",
							"            console.log(res);",
							"        }",
							"    }",
							");",
							"",
							"// Create a randomized address to avoid duplicate addresses for the first request. But we need this also to create duplicate address on the second attempt",
							"pm.environment.set(\"randomizedStreet\", Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15));"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"address\": {\n\t\t\"firstName\": \"Test\",\n        \"lastName\": \"Moped\",\n        \"company\": \"Moped AG\",\n        \"street1\": \"{{randomizedStreet}}\",\n        \"street2\": \"Moped\",\n        \"city\": \"Mopedhausen\",\n        \"state\": \"Mopedville\",\n        \"phone\": \"555-Nase\",\n        \"isDefault\": false,\n        \"alias\": null,\n        \"zipcode\": \"12345\",\n        \"country\": \"GB\"\n\t}\n}"
				},
				"url": {
					"raw": "{{addAddressUrl}}",
					"host": [
						"{{addAddressUrl}}"
					]
				},
				"description": ""
			},
			"response": []
		}
	]
}